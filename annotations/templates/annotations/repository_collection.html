{% extends "annotations/base.html" %}
{% load app_filters %}
{% load addcss %}
{% load staticfiles %}

{% block breadcrumbs %}
<a href="{% url "home" %}" class="btn btn-xs">Home</a>&raquo;
<a href="{% url "repository_list" %}{% if project_id %}?project_id={{ project_id }}{% endif %}" class="btn btn-xs">Repositories</a>&raquo;
<a href="{% url "repository_details" repository.id %}{% if project_id %}?project_id={{ project_id }}{% endif %}" class="btn btn-xs">{{ repository.name }}</a>&raquo;
<a href="{% url "repository_collections" repository.id %}{% if project_id %}?project_id={{ project_id }}{% endif %}" class="btn btn-xs">Collections</a>&raquo;
<a href="{% url "repository_collection" repository.id group_id %}{% if project_id %}?project_id={{ project_id }}{% endif %}" class="btn btn-xs">{{ group.name }}</a>
{% endblock %}

{% block main %}
<script src="{% static "annotations/js/bootstrap-datepicker.min.js" %}"></script>

<div class="container">
    <div class="h4 mb-4">Collections in group {{ group.name }} of repository <strong>{{ repository.name }}</strong></div>

    <div class="row">
        <!-- Sidebar with collections -->
        <div class="col-md-3">
            <div class="list-group">
                <div class="list-group-item active">
                    <h5 class="list-group-item-heading mb-0">Collections</h5>
                </div>

                <!-- Collections -->
                {% for collection in collections %}
                <div class="list-group-item">
                    <div class="d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">{{ collection.name }}</h6>
                                <small class="text-muted d-block">Items: {{ collection.numberOfItems }}</small>
                            </div>
                            <a href="{% url "repository_collections_text_list" repository.id group_id collection.key %}{% if project_id %}?project_id={{ project_id }}{% endif %}" 
                               class="text-primary ms-2 rounded-circle bg-primary p-2" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; float: right;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-eye" viewBox="0 0 16 16">
                                    <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
                                    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Main content area with texts table -->
        <div class="col-md-9">
            <h5 class="mb-4">Group Texts</h5>
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Authors</th>
                            <th>Item Type</th>
                            <th>Volume</th>
                            <th>Pages</th>
                            <th>URL</th>
                            <th>Date Added</th>
                            <th>Files</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for text in group_texts %}
                        <tr>
                            <td><small>{{ text.title }}</small></td>
                            <td>
                                <small>
                                {% for author in text.authors %}
                                    {% if author.firstName and author.lastName %}
                                        {{ author.firstName }} {{ author.lastName }}
                                    {% else %}
                                        {{ author.name }}
                                    {% endif %}
                                    {% if not forloop.last %}, {% endif %}
                                {% empty %}
                                    No authors listed
                                {% endfor %}
                                </small>
                            </td>
                            <td><small>{{ text.itemType }}</small></td>
                            <td><small>{{ text.volume|default:"N/A" }}</small></td>
                            <td><small>{{ text.pages|default:"N/A" }}</small></td>
                            <td><small><a href="{{ text.url|default:"#" }}" target="_blank">{{ text.url|default:"No URL" }}</a></small></td>
                            <td><small>{{ text.dateAdded }}</small></td>
                            <td>{% if text.gilesUploads and text.gilesUploads|length > 0 %}<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-file-earmark" viewBox="0 0 16 16">
                                <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5z"/>
                              </svg>{% else %}{% endif %}</td>
                            <td>
                                <button class="btn btn-info btn-sm">Import</button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="9" class="text-center"><small>No texts available.</small></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    {% if current_page > 1 %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ current_page|add:-1 }}{% if project_id %}&project_id={{ project_id }}{% endif %}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                    {% endif %}

                    {% for i in page_range %}
                        {% if current_page == i %}
                            <li class="page-item active">
                                <span class="page-link">{{ i }} <span class="sr-only">(current)</span></span>
                            </li>
                        {% else %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ i }}{% if project_id %}&project_id={{ project_id }}{% endif %}">{{ i }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    {% if current_page < total_pages %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ current_page|add:1 }}{% if project_id %}&project_id={{ project_id }}{% endif %}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
</div>
{% endblock %}
